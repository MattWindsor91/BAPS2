<!--
The main channel control.
-->
<UserControl x:Class="URY.BAPS.Client.Wpf.Controls.Channel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:fa="http://schemas.fontawesome.io/icons/"
             xmlns:dd="urn:gong-wpf-dragdrop"
             xmlns:converters="clr-namespace:URY.BAPS.Client.Wpf.Converters"
             xmlns:controls="clr-namespace:URY.BAPS.Client.Wpf.Controls"
             xmlns:viewModel="clr-namespace:URY.BAPS.Client.Wpf.ViewModel"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800" Width="360"
             d:DataContext="{d:DesignInstance viewModel:ChannelViewModel}">
    <UserControl.Resources>
        <converters:EntryTypeToIconConverter x:Key="EntryTypeToIconConverter" />
        <Thickness x:Key="ChannelBarMargin">6px</Thickness>
        <!-- ChannelBarHeight - (2*ChannelBarMargin) -->
        <sys:Double x:Key="ChannelBarHeightMinusMargin">20</sys:Double>
        <!-- Tango colours (for now) -->
        <SolidColorBrush x:Key="ChannelLegendLampOut" Color="#FF888a85" />
        <SolidColorBrush x:Key="ChannelLegendLampOn" Color="#FFEEEEEC" />
        <SolidColorBrush x:Key="ChannelLegendLampAlt" Color="#FFEF2929" />
        <!-- Styles -->
        <Style x:Key="ChannelLampStyle" TargetType="{x:Type fa:ImageAwesome}">
            <Setter Property="Height" Value="{StaticResource ChannelBarHeightMinusMargin}" />
            <Setter Property="Width" Value="{StaticResource ChannelBarHeightMinusMargin}" />
            <Setter Property="Margin" Value="{StaticResource ChannelBarMargin}" />
            <Setter Property="Foreground" Value="{StaticResource ChannelLegendLampOut}" />
        </Style>
    </UserControl.Resources>
    <DockPanel>
        <controls:Header
            DockPanel.Dock="Top"
            Icon="Music"
            Text="{Binding Name}">
            <StackPanel Orientation="Horizontal" FlowDirection="RightToLeft">
                <fa:ImageAwesome Icon="Repeat" ToolTip="Repeat mode">
                    <fa:ImageAwesome.Style>
                        <Style TargetType="{x:Type fa:ImageAwesome}"
                               BasedOn="{StaticResource ChannelLampStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=RepeatMode}" Value="All">
                                    <Setter Property="Foreground" Value="{StaticResource ChannelLegendLampAlt}" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Path=RepeatMode}" Value="One">
                                    <Setter Property="Foreground" Value="{StaticResource ChannelLegendLampOn}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </fa:ImageAwesome.Style>
                </fa:ImageAwesome>
                <fa:ImageAwesome Icon="AngleDoubleDown" ToolTip="Auto Advance">
                    <fa:ImageAwesome.Style>
                        <Style TargetType="{x:Type fa:ImageAwesome}"
                               BasedOn="{StaticResource ChannelLampStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=IsAutoAdvance}" Value="true">
                                    <Setter Property="Foreground" Value="{StaticResource ChannelLegendLampOn}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </fa:ImageAwesome.Style>
                </fa:ImageAwesome>
                <fa:ImageAwesome
                    Icon="PlayCircleOutline"
                    ToolTip="Play on load">
                    <fa:ImageAwesome.Style>
                        <Style TargetType="{x:Type fa:ImageAwesome}"
                               BasedOn="{StaticResource ChannelLampStyle}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Path=IsPlayOnLoad}" Value="true">
                                    <Setter Property="Foreground" Value="{StaticResource ChannelLegendLampOn}" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </fa:ImageAwesome.Style>
                </fa:ImageAwesome>
            </StackPanel>
        </controls:Header>
        <controls:Player DockPanel.Dock="Bottom" DataContext="{Binding Player}" />
        <ListBox
            HorizontalContentAlignment="Stretch"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            ItemsSource="{Binding TrackList,UpdateSourceTrigger=PropertyChanged}"
            dd:DragDrop.IsDropTarget="True"
            dd:DragDrop.DropHandler="{Binding}"
            SelectionChanged="TrackList_SelectionChanged"><!--SelectedIndex="{Binding SelectedItemIndex, Mode=OneWay}"-->
            <ListBox.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="_Reset Channel" />
                    <Separator />
                    <MenuItem Header="_Delete Item" />
                    <Separator />
                    <MenuItem
                        Header="_Auto advance"
                        IsCheckable="True" IsChecked="{Binding IsAutoAdvance, Mode=OneWay}"
                        Command="{Binding ToggleAutoAdvanceCommand}" />
                    <MenuItem
                        Header="_Play on load"
                        IsCheckable="True" IsChecked="{Binding IsPlayOnLoad, Mode=OneWay}"
                        Command="{Binding TogglePlayOnLoadCommand}" />
                    <Separator />
                    <MenuItem Header="Repeat a_ll" />
                    <MenuItem Header="Repeat _one" />
                    <MenuItem Header="Repeat _none" />
                    <Separator />
                    <MenuItem Header="_Show audio wall" />
                </ContextMenu>
            </ListBox.ContextMenu>
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type viewModel:TrackViewModel}">
                    <Border BorderThickness="2px" CornerRadius="4">
                        <Border.Style>
                            <Style TargetType="{x:Type Border}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsLoaded}" Value="True">
                                        <Setter Property="BorderBrush" Value="{StaticResource AccentBg}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="24px" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="24px" />
                            </Grid.RowDefinitions>
                            <fa:ImageAwesome Grid.Row="0" Grid.Column="0"
                                             Foreground="Black"
                                             Margin="2px"
                                             Icon="{Binding Converter={StaticResource EntryTypeToIconConverter}}" />
                            <TextBlock Grid.Row="0" Grid.Column="1"
                                       VerticalAlignment="Center"
                                       Margin="2px"
                                       FontSize="10pt"
                                       ToolTip="{Binding Description}"
                                       Text="{Binding Description}" />
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </DockPanel>
</UserControl>